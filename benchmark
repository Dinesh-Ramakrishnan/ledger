#!/bin/sh

TMPDIR=/tmp
if [ -d /Volumes/RamDisk ]; then
    TMPDIR=/Volumes/RamDisk
fi

rsync -Lav --delete --delete-excluded \
    --exclude="autom4te.cache/" \
    --exclude=".libs/"	  \
    --exclude="build/"	  \
    --exclude="CVS/"	  \
    --exclude="branches/" \
    --exclude="*.[oa]"	  \
    --exclude="*.l[oa]"   \
    --exclude="*.so"	  \
    --exclude="ledger"	  \
    --exclude="*~"	  \
    --exclude="_darcs/"   \
    --exclude="scripts/"  \
    ./ $TMPDIR/ledger-verify/

cd $TMPDIR/ledger-bench
make all-clean > /dev/null 2>&1

if ./acprep --flat-opt && make ledger; then
   strip ledger
   utils/speedcmp 50 ./ledger
fi
